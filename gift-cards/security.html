


<!DOCTYPE html>
<html lang="en-US">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="theme-color" content="#000">
        <meta name="application-name" content="Gift Cards – Security">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title"
            content="Gift Cards – Security">
        <meta name="msapplication-TileColor" content="#000">
        <meta name="msapplication-TileImage" content="https://design.swedbankpay.com/v/4.5.0/icons/mstile-144x144.png">
        <meta property="og:type" value="website" />
        
        <meta property="og:url" value="/gift-cards/security.html" />
        <meta property="og:title" value="Gift Cards – Security" />
        <meta name="title" content="Gift Cards – Security" />
        
        <meta property="og:description" value="Swedbank Pay Developer Portal" />
        <meta name="description" content="Swedbank Pay Developer Portal" />
        
        <meta property="og:image" value="/assets/img/swedbank-pay-developer-portal.png" />
        <title>Gift Cards – Security</title>
        <link rel="stylesheet" href="https://design.swedbankpay.com/v/4.5.0/styles/dg-style.css" />
        <link rel="stylesheet" href="/assets/css/swedbank-pay-design-guide-theme.css" />
        <link rel="stylesheet" href="/assets/css/pygments-autumn.css" />
        <link rel="shortcut icon" href="https://design.swedbankpay.com/v/4.5.0/icons/favicon.ico">
        <link rel="icon" type="image/png" sizes="16x16" href="https://design.swedbankpay.com/v/4.5.0/icons/favicon-16x16.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://design.swedbankpay.com/v/4.5.0/icons/favicon-32x32.png">
        <link rel="apple-touch-icon" sizes="57x57"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="167x167"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-167x167.png">
        <link rel="apple-touch-icon" sizes="180x180"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-180x180.png">
        <link rel="apple-touch-icon" sizes="1024x1024"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-icon-1024x1024.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-320x460.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-640x920.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-640x1096.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-750x1294.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-1182x2208.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-1242x2148.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-748x1024.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-768x1004.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-1496x2048.png">
        <link rel="apple-touch-startup-image"
            media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)"
            href="https://design.swedbankpay.com/v/4.5.0/icons/apple-touch-startup-image-1536x2008.png">
        <link rel="icon" type="image/png" sizes="228x228" href="https://design.swedbankpay.com/v/4.5.0/icons/coast-228x228.png">
        <script src="/assets/js/mermaid.min.js"></script>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="/assets/tipuesearch/tipuesearch_content.js"></script>
        <script src="/assets/tipuesearch/tipuesearch_set.js"></script>
        <script src="/assets/tipuesearch/tipuesearch.min.js"></script>
        
        <link href="https://fonts.googleapis.com/css?family=Material+Icons+Outlined" rel="stylesheet">
    </head>

    <body>
        <div id="designguide">
            <header class="topbar topbar-md-wide designguide-header">
                <button type="button" class="topbar-btn"><i class="material-icons topbar-btn-icon">menu</i></button>
                <a href="" class="topbar-logo"><img
                        src="https://design.swedbankpay.com/v/4.5.0/img/swedbankpay-logo.svg" alt="logo"></a>
                <nav class="topbar-nav">
                    <div class="topbar-link-container">
                        <button type="button" class="topbar-close"><i class="material-icons">close</i></button>

                        
                        

                        

                        <a 
                            href="/"><span>Home</span></a>

                        
                        
                        <a 
                            href="/checkout/"><span>Checkout</span></a>
                        
                        
                        <a 
                            href="/payments/"><span>Payments</span></a>
                        
                        
                        <a 
                            href="/gift-cards/"><span>Gift Cards</span></a>
                        
                        
                        <a 
                            href="/resources/"><span>Resources</span></a>
                        

                        <div class="topbar-info topbar-link-right">
                            <div class="topbar-info-contact">
                                <a href="https://github.com/SwedbankPay/developer.swedbankpay.com/tree/develop/gift-cards/security.md"
                                    target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub">
                                    <svg aria-labelledby="simpleicons-github-icon" role="img" viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <title id="simpleicons-github-icon">Edit this page on GitHub</title>
                                        <path
                                            d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>
            </header>

            <div class="documentation">
                <div class="row">
                    <div class="col-xxl-2 col-md-3">
                        <div class="doc-sidebar">
                            
                            <form class="doc-search" action="/search">
                                <input type="text" class="form-control" name="q" id="tipue_search_input"
                                    placeholder="Search..." autocomplete="off" pattern=".{3,}"
                                    title="At least 3 characters">
                            </form>
                            
                            
                            <nav class="documentation-nav">
                                
                                
                                <div class="nav-group active">
                                    <div class="nav-heading">
                                        <i class="material-icons">keyboard_arrow_right</i>
                                        <span>Gift Cards</span>
                                    </div>

                                    
                                    <ul>
                                        
                                        
                                        <li><a  href="/gift-cards/"><span>Introduction</span></a></li>
                                        
                                        
                                        <li><a  href="/gift-cards/operations"><span>Operations</span></a></li>
                                        
                                        
                                        <li><a  aria-current="page" class="active"
                                                 href="/gift-cards/security"><span>Security</span></a></li>
                                        
                                        
                                        <li><a  href="/gift-cards/payment-client"><span>Test Client</span></a></li>
                                        
                                        
                                        <li><a  href="/gift-cards/other-features"><span>Other Features</span></a></li>
                                        
                                    </ul>
                                    
                                </div>
                                
                            </nav>
                            
                        </div>
                    </div>

                    <main class="doc-view col-xxl-10 col-md-9">
                        <div class="doc-container">
                            <h1>Gift Cards – Security</h1>
                            <div class="row">
                                <div class="doc-body col-lg-10">
                                    
                                    <h2 id="oauth2">
        
        
          OAuth2 <a href="#oauth2" class="header-anchor"></a>
        
        
      </h2>

<p>The Gift Card API requires an OAuth2 access token for interaction. This
application automatically handles token fetching and refreshing by using <a href="https://spring.io/projects/spring-security-oauth">Spring
Security</a>. Configuration values are set in
<a href="https://github.com/SwedbankPay/vas-payment-api-client/blob/master/backend/src/main/resources/application.yml">application.yml</a>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1"># "XXX" Should be replaced by value provided by Swebank Pay</span>
<span class="c1"># CLIENT_ID/CLIENT_SECRET/VAS_AUTH_SERVER_URL can also be set in docker-compose.yml as environment variables if running with docker</span>
<span class="na">vas-payment-api</span><span class="pi">:</span>
    <span class="na">oauth2</span><span class="pi">:</span>
        <span class="na">client</span><span class="pi">:</span>
            <span class="na">grantType</span><span class="pi">:</span> <span class="s">client_credentials</span>
            <span class="na">clientId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${CLIENT_ID}:XXX"</span>
            <span class="na">clientSecret</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${CLIENT_SECRET}:XXX"</span>
            <span class="na">accessTokenUri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${VAS_AUTH_SERVER_URL}:XXX"</span>
            <span class="na">scope</span><span class="pi">:</span> <span class="s">publicapi</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>And the implementation of these are located in
<a href="https://github.com/SwedbankPay/vas-payment-api-client/blob/master/backend/src/main/java/com/swedbankpay/vas/demo/config/security/Oauth2RestTemplateConfiguration.java">Oauth2RestTemplateConfiguration.java</a>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Oauth2RestTemplateConfiguration</span> <span class="o">{</span>
    <span class="c1">//...</span>
    <span class="nd">@Bean</span>
    <span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="s">"vas-payment-api.oauth2.client"</span><span class="o">)</span>
    <span class="kd">protected</span> <span class="nc">ClientCredentialsResourceDetails</span> <span class="nf">oAuthDetails</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ClientCredentialsResourceDetails</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">protected</span> <span class="nc">RestTemplate</span> <span class="nf">restTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">restTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OAuth2RestTemplate</span><span class="o">(</span><span class="n">oAuthDetails</span><span class="o">());</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">setInterceptors</span><span class="o">(</span><span class="nc">ImmutableList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">externalRequestInterceptor</span><span class="o">()));</span>
        <span class="n">restTemplate</span><span class="o">.</span><span class="na">setRequestFactory</span><span class="o">(</span><span class="n">httpRequestFactory</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">restTemplate</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//...</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
    
      <h2 id="hmac">
        
        
          HMAC <a href="#hmac" class="header-anchor"></a>
        
        
      </h2>

<p>A Hash-based Message Authentication Code (<a href="https://en.wikipedia.org/wiki/HMAC">HMAC</a>) is used to verify the
data integrity and authenticity of the HTTP requests made towards our API.</p>

<p>An HMAC header therefore needs  to be present in every request. In this client
the HMAC value is automatically calculated by
<a href="https://github.com/SwedbankPay/vas-payment-api-client/blob/master/backend/src/main/java/com/swedbankpay/vas/demo/config/security/HmacSignatureBuilder.java">HmacSignatureBuilder.java</a> and added to all outgoing
requests in <a href="https://github.com/SwedbankPay/vas-payment-api-client/blob/master/backend/src/main/java/com/swedbankpay/vas/demo/config/ExternalRequestInterceptor.java">ExternalRequestInterceptor.java</a></p>

<p>HMAC is implemented using SHA-512 secure hash algorithm.</p>

<p>Expected <code class="language-html highlighter-rouge">Hmac</code> header format is:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HmacSHA512 &lt;user&gt;:&lt;nonce&gt;:&lt;digest&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>where <code class="language-html highlighter-rouge">digest</code> is a Base64 formatted HMAC SHA512 digest of the following string:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>METHOD\n
RESOURCE\n
USER\
NONCE\n
DATE\n
PAYLOAD\n
</pre></td></tr></tbody></table></code></pre></div></div>

<table class="table table-striped">
  <thead>
    <tr>
      <th style="text-align: center">Required</th>
      <th style="text-align: left">Field</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><i class="material-icons">check</i></td>
      <td style="text-align: left"><code class="language-html highlighter-rouge">METHOD</code></td>
      <td style="text-align: left">The requested method (in upper case)</td>
    </tr>
    <tr>
      <td style="text-align: center"><i class="material-icons">check</i></td>
      <td style="text-align: left"><code class="language-html highlighter-rouge">RESOURCE</code></td>
      <td style="text-align: left">The path to desired resource (without hostname and any query parameters)</td>
    </tr>
    <tr>
      <td style="text-align: center"><i class="material-icons">check</i></td>
      <td style="text-align: left"><code class="language-html highlighter-rouge">NONSE</code></td>
      <td style="text-align: left">A unique value for each request (<a href="https://tools.ietf.org/rfc/rfc4122.txt">UUID</a></td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: left"><code class="language-html highlighter-rouge">DATE</code></td>
      <td style="text-align: left">Same as <code class="language-html highlighter-rouge">Transmission-Time</code> if provided as seperate header. Uses <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601 standard</a></td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: left"><code class="language-html highlighter-rouge">PAYLOAD</code></td>
      <td style="text-align: left">The body of request</td>
    </tr>
  </tbody>
</table>

<p>Example request:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-X</span> POST <span class="se">\</span>
  https://stage-evc.payex.com/payment-api/api/payments/payment-account/balance <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Accept: */*'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Agreement-Merchant-Id: XXX'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Authorization: Bearer XXX'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Hmac: HmacSHA512 user:21a0213e-30eb-85ab-b355-a310d31af30e:oY5Q5Rf1anCz7DRm3GyWR0dvJDnhl/psylfnNCn6FA0NOrQS3L0fvyUsQ1IQ9gQPeLUt9J3IM2zwoSfZpDgRJA=='</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Transmission-Time: 2019-06-18T09:19:15.208257Z'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Session-Id: e0447bd2-ab64-b456-b17b-da274bb8428e'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "accountIdentifier": {
        "accountKey": "7013369000000000000",
        "cvc": "123",
        "expiryDate": "2019-12-31",
        "instrument": "GC"
    }
}'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this example <code class="language-html highlighter-rouge">USER</code> is user and <code class="language-html highlighter-rouge">SECRET</code> is secret.</p>

<p>The plain text string to <code class="language-html highlighter-rouge">digest</code> would then look like the following:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>POST
/payment-api/api/payments/payment-account/balance
user
21a0213e-30eb-85ab-b355-a310d31af30e
2019-06-18T09:19:15.208257Z
{
    "accountIdentifier": {
        "accountKey": "7013360000000000000",
        "cvc": "123",
        "expiryDate": "2020-12-31",
        "instrument": "CC"
    }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The plain <code class="language-html highlighter-rouge">digest</code> string is then hashed with <code class="language-html highlighter-rouge">HmacSHA512</code> algorithm and the
<code class="language-html highlighter-rouge">SECRET</code>. Finally we base 64 encode the hashed value. This is the final <code class="language-html highlighter-rouge">digest</code>
to be provided in the <code class="language-html highlighter-rouge">Hmac</code> header.</p>

<p>Final <code class="language-html highlighter-rouge">Hmac</code> header value:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HmacSHA512 user:21a0213e-30eb-85ab-b355-a310d31af30e:oY5Q5Rf1anCz7DRm3GyWR0dvJDnhl/psylfnNCn6FA0NOrQS3L0fvyUsQ1IQ9gQPeLUt9J3IM2zwoSfZpDgRJA==
</pre></td></tr></tbody></table></code></pre></div></div>
    
      <h3 id="postman-example-script-for-generation-hmac-header">
        
        
          Postman example script for generation HMAC header <a href="#postman-example-script-for-generation-hmac-header" class="header-anchor"></a>
        
        
      </h3>

<p>In pre-request script copy/paste the following snippet.</p>

<p class="code-header"><strong>JavaScript</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Systemtest</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">secret</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Systemtest</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">transmissionTime</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">toISOString</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">sessionId</span> <span class="o">=</span> <span class="nx">guid</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">generateHMAC</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">transmissionTime</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">hmac: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">hmac</span><span class="p">);</span>

<span class="c1">//Set header values</span>
<span class="nx">pm</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="na">key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Hmac</span><span class="dl">'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">hmac</span> <span class="p">});</span>
<span class="nx">pm</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="na">key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Transmission-Time</span><span class="dl">'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">transmissionTime</span> <span class="p">});</span>
<span class="nx">pm</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="na">key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Session-Id</span><span class="dl">'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">sessionId</span> <span class="p">});</span>

<span class="kd">function</span> <span class="nx">generateHMAC</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">transmissionTime</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">algorithm</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">HmacSHA512</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">separator</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">nonce</span> <span class="o">=</span> <span class="nx">generateNonce</span><span class="p">();</span> <span class="c1">//UUID</span>
    <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">transmissionTime</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">uri_path</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="dl">'</span><span class="s1">^https?://[^/]+/</span><span class="dl">'</span><span class="p">),</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// strip hostname</span>
    <span class="nx">uri_path</span> <span class="o">=</span> <span class="nx">uri_path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">?</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//Remove query paramters</span>
    <span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">?</span> <span class="dl">""</span> <span class="p">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">macData</span> <span class="o">=</span> <span class="nx">method</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span>
        <span class="o">+</span> <span class="nx">uri_path</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span>
        <span class="o">+</span> <span class="nx">user</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span>
        <span class="o">+</span> <span class="nx">nonce</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span>
        <span class="o">+</span> <span class="nx">date</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span>
        <span class="o">+</span> <span class="nx">payload</span> <span class="o">+</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">macData</span> <span class="o">=</span> <span class="nx">replaceRequestEnv</span><span class="p">(</span><span class="nx">macData</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">data to mac: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">macData</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA512</span><span class="p">(</span><span class="nx">macData</span><span class="p">,</span> <span class="nx">secret</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">digest</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">hash</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">algorithm</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">user</span> <span class="o">+</span> <span class="nx">separator</span> <span class="o">+</span> <span class="nx">nonce</span> <span class="o">+</span> <span class="nx">separator</span> <span class="o">+</span> <span class="nx">digest</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">replaceRequestEnv</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//manually set environments to they are populated before hashing</span>
    <span class="k">return</span> <span class="nx">input</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\{\{(</span><span class="sr">.*</span><span class="se">?)\}\}</span><span class="sr">/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span> <span class="p">?</span> <span class="nx">pm</span><span class="p">.</span><span class="nx">varables</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">:</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">generateNonce</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">guid</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">guid</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">s4</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">())</span> <span class="o">*</span> <span class="mh">0x10000</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span> <span class="o">+</span>
        <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
    
      <h2 id="security-documentation">
        
        
          Security Documentation <a href="#security-documentation" class="header-anchor"></a>
        
        
      </h2>

<ul>
  <li><a href="https://oauth.net/2/">OAuth2</a></li>
  <li><a href="https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/">Client Credentials</a></li>
  <li><a href="http://restcookbook.com/Basics/loggingin/">The RESTful CookBook: HMAC</a></li>
  <li><a href="https://en.wikipedia.org/wiki/HMAC">HMAC - Wikipedia</a></li>
</ul>
    
      <h2 id="test-client">
        
        
          Test client <a href="#test-client" class="header-anchor"></a>
        
        
      </h2>

<ul>
  <li>For more information how to implement the api, see
<a href="/gift-cards/payment-client">Test Client</a>.</li>
</ul>
                                    
                                </div>

                                <div class="col-2 d-none d-lg-block">
                                    <nav class="doc-toc">
                                        <ul>
  <li class="toc-2"><a href="#oauth2">OAuth2</a></li>
  <li class="toc-2"><a href="#hmac">HMAC</a></li>
  <li class="toc-2"><a href="#security-documentation">Security Documentation</a></li>
  <li class="toc-2"><a href="#test-client">Test client</a></li>
</ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>

            <footer class="page-footer">
                <p class="page-footer-rights">© Swedbank Pay</p>
            </footer>
        </div>

        <script src="https://design.swedbankpay.com/v/4.5.0/scripts/dg.js"></script>
        <script src="/assets/js/swedbank-pay-design-guide-theme.js"></script>
        
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156582708-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156582708-1');
</script>

        
    </body>
    
    <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
    

</html>